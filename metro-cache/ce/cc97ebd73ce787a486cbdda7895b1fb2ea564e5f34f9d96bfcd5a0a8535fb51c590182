{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"locs":[{"start":{"line":52,"column":61},"end":{"line":55,"column":3}}]}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"locs":[{"start":{"line":1,"column":0},"end":{"line":182,"column":0}}]}},{"name":"@babel/runtime/helpers/extends","data":{"asyncType":null,"locs":[{"start":{"line":73,"column":11},"end":{"line":76,"column":8}}]}},{"name":"../Utilities/infoLog","data":{"asyncType":null,"locs":[{"start":{"line":103,"column":19},"end":{"line":103,"column":73}},{"start":{"line":106,"column":19},"end":{"line":106,"column":62}},{"start":{"line":114,"column":19},"end":{"line":114,"column":59}},{"start":{"line":142,"column":8},"end":{"line":145,"column":10}},{"start":{"line":160,"column":13},"end":{"line":160,"column":63}},{"start":{"line":161,"column":13},"end":{"line":161,"column":61}},{"start":{"line":166,"column":10},"end":{"line":169,"column":12}}]}},{"name":"invariant","data":{"asyncType":null,"locs":[{"start":{"line":109,"column":10},"end":{"line":113,"column":11}}]}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var DEBUG = false;\n\n  var TaskQueue = function () {\n    function TaskQueue(_ref) {\n      var onMoreTasks = _ref.onMoreTasks;\n\n      _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\")(this, TaskQueue);\n\n      this._onMoreTasks = onMoreTasks;\n      this._queueStack = [{\n        tasks: [],\n        popable: false\n      }];\n    }\n\n    _$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/helpers/createClass\")(TaskQueue, [{\n      key: \"enqueue\",\n      value: function enqueue(task) {\n        this._getCurrentQueue().push(task);\n      }\n    }, {\n      key: \"enqueueTasks\",\n      value: function enqueueTasks(tasks) {\n        var _this = this;\n\n        tasks.forEach(function (task) {\n          return _this.enqueue(task);\n        });\n      }\n    }, {\n      key: \"cancelTasks\",\n      value: function cancelTasks(tasksToCancel) {\n        this._queueStack = this._queueStack.map(function (queue) {\n          return _$$_REQUIRE(_dependencyMap[2], \"@babel/runtime/helpers/extends\")({}, queue, {\n            tasks: queue.tasks.filter(function (task) {\n              return tasksToCancel.indexOf(task) === -1;\n            })\n          });\n        }).filter(function (queue, idx) {\n          return queue.tasks.length > 0 || idx === 0;\n        });\n      }\n    }, {\n      key: \"hasTasksToProcess\",\n      value: function hasTasksToProcess() {\n        return this._getCurrentQueue().length > 0;\n      }\n    }, {\n      key: \"processNext\",\n      value: function processNext() {\n        var queue = this._getCurrentQueue();\n\n        if (queue.length) {\n          var task = queue.shift();\n\n          try {\n            if (typeof task === 'object' && task.gen) {\n              DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: genPromise for task ' + task.name);\n\n              this._genPromise(task);\n            } else if (typeof task === 'object' && task.run) {\n              DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: run task ' + task.name);\n              task.run();\n            } else {\n              _$$_REQUIRE(_dependencyMap[4], \"invariant\")(typeof task === 'function', 'Expected Function, SimpleTask, or PromiseTask, but got:\\n' + JSON.stringify(task, null, 2));\n\n              DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: run anonymous task');\n              task();\n            }\n          } catch (e) {\n            e.message = 'TaskQueue: Error with task ' + (task.name || '') + ': ' + e.message;\n            throw e;\n          }\n        }\n      }\n    }, {\n      key: \"_getCurrentQueue\",\n      value: function _getCurrentQueue() {\n        var stackIdx = this._queueStack.length - 1;\n        var queue = this._queueStack[stackIdx];\n\n        if (queue.popable && queue.tasks.length === 0 && this._queueStack.length > 1) {\n          this._queueStack.pop();\n\n          DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: popped queue: ', {\n            stackIdx: stackIdx,\n            queueStackSize: this._queueStack.length\n          });\n          return this._getCurrentQueue();\n        } else {\n          return queue.tasks;\n        }\n      }\n    }, {\n      key: \"_genPromise\",\n      value: function _genPromise(task) {\n        var _this2 = this;\n\n        this._queueStack.push({\n          tasks: [],\n          popable: false\n        });\n\n        var stackIdx = this._queueStack.length - 1;\n        var stackItem = this._queueStack[stackIdx];\n        DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: push new queue: ', {\n          stackIdx: stackIdx\n        });\n        DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: exec gen task ' + task.name);\n        task.gen().then(function () {\n          DEBUG && _$$_REQUIRE(_dependencyMap[3], \"../Utilities/infoLog\")('TaskQueue: onThen for gen task ' + task.name, {\n            stackIdx: stackIdx,\n            queueStackSize: _this2._queueStack.length\n          });\n          stackItem.popable = true;\n          _this2.hasTasksToProcess() && _this2._onMoreTasks();\n        }).catch(function (ex) {\n          ex.message = \"TaskQueue: Error resolving Promise in task \" + task.name + \": \" + ex.message;\n          throw ex;\n        }).done();\n      }\n    }]);\n\n    return TaskQueue;\n  }();\n\n  module.exports = TaskQueue;\n});","lineCount":131,"map":[[2,0,11,0],[4,0,26,0],[4,6,26,6,"DEBUG"],[4,11,26,18],[4,14,26,21],[4,19,26,0],[6,6,44,6,"TaskQueue"],[6,15],[7,0,52,2],[7,29,52,61],[8,0,52,61],[8,10,52,15,"onMoreTasks"],[8,21,52,61],[8,29,52,15,"onMoreTasks"],[8,40,52,61],[10,0,52,61],[12,0,53,4],[12,11,53,9,"_onMoreTasks"],[12,23,53,4],[12,26,53,24,"onMoreTasks"],[12,37,53,4],[13,0,54,4],[13,11,54,9,"_queueStack"],[13,22,54,4],[13,25,54,23],[13,26,54,24],[14,0,54,25,"tasks"],[14,8,54,25,"tasks"],[14,13,54,30],[14,15,54,32],[14,17,54,24],[15,0,54,36,"popable"],[15,8,54,36,"popable"],[15,15,54,43],[15,17,54,45],[16,0,54,24],[16,7,54,23],[16,8,54,4],[17,0,55,3],[21,13,62,2],[21,30,62,10,"task"],[21,34,62,2],[21,36,62,28],[22,0,63,4],[22,13,63,9,"_getCurrentQueue"],[22,29,63,4],[22,32,63,28,"push"],[22,36,63,4],[22,37,63,33,"task"],[22,41,63,4],[23,0,64,3],[26,13,66,2],[26,35,66,15,"tasks"],[26,40,66,2],[26,42,66,41],[27,0,66,41],[29,0,67,4,"tasks"],[29,8,67,4,"tasks"],[29,13,67,9],[29,14,67,10,"forEach"],[29,21,67,4],[29,22,67,18],[29,32,67,18,"task"],[29,36,67,22],[30,0,67,22],[30,17,67,26],[30,22,67,30],[30,23,67,31,"enqueue"],[30,30,67,26],[30,31,67,39,"task"],[30,35,67,26],[30,36,67,22],[31,0,67,22],[31,9,67,4],[32,0,68,3],[35,13,70,2],[35,34,70,14,"tasksToCancel"],[35,47,70,2],[35,49,70,48],[36,0,72,4],[36,13,72,9,"_queueStack"],[36,24,72,4],[36,27,72,23],[36,32,72,28,"_queueStack"],[36,43,72,23],[36,44,73,7,"map"],[36,47,72,23],[36,48,73,11],[36,58,73,11,"queue"],[36,63,73,16],[37,0,73,16],[37,86,74,11,"queue"],[37,91,73,16],[38,0,75,8,"tasks"],[38,12,75,8,"tasks"],[38,17,75,13],[38,19,75,15,"queue"],[38,24,75,20],[38,25,75,21,"tasks"],[38,30,75,15],[38,31,75,27,"filter"],[38,37,75,15],[38,38,75,34],[38,48,75,34,"task"],[38,52,75,38],[39,0,75,38],[39,21,75,42,"tasksToCancel"],[39,34,75,55],[39,35,75,56,"indexOf"],[39,42,75,42],[39,43,75,64,"task"],[39,47,75,42],[39,53,75,74],[39,54,75,75],[39,55,75,38],[40,0,75,38],[40,13,75,15],[41,0,73,16],[42,0,73,16],[42,9,72,23],[42,11,77,7,"filter"],[42,17,72,23],[42,18,77,14],[42,28,77,15,"queue"],[42,33,77,14],[42,35,77,22,"idx"],[42,38,77,14],[43,0,77,14],[43,17,77,30,"queue"],[43,22,77,35],[43,23,77,36,"tasks"],[43,28,77,30],[43,29,77,42,"length"],[43,35,77,30],[43,38,77,51],[43,39,77,30],[43,43,77,56,"idx"],[43,46,77,59],[43,51,77,64],[43,52,77,14],[44,0,77,14],[44,9,72,23],[44,10,72,4],[45,0,78,3],[48,13,90,2],[48,42,90,31],[49,0,91,4],[49,15,91,11],[49,20,91,16,"_getCurrentQueue"],[49,36,91,11],[49,39,91,35,"length"],[49,45,91,11],[49,48,91,44],[49,49,91,4],[50,0,92,3],[53,13,97,2],[53,36,97,22],[54,0,98,4],[54,12,98,10,"queue"],[54,17,98,15],[54,20,98,18],[54,25,98,23,"_getCurrentQueue"],[54,41,98,18],[54,43,98,4],[56,0,99,4],[56,12,99,8,"queue"],[56,17,99,13],[56,18,99,14,"length"],[56,24,99,4],[56,26,99,22],[57,0,100,6],[57,14,100,12,"task"],[57,18,100,16],[57,21,100,19,"queue"],[57,26,100,24],[57,27,100,25,"shift"],[57,32,100,19],[57,34,100,6],[59,0,101,6],[59,14,101,10],[60,0,102,8],[60,16,102,12],[60,23,102,19,"task"],[60,27,102,12],[60,32,102,28],[60,40,102,12],[60,44,102,40,"task"],[60,48,102,44],[60,49,102,45,"gen"],[60,52,102,8],[60,54,102,50],[61,0,103,10,"DEBUG"],[61,14,103,10,"DEBUG"],[61,19,103,15],[61,23,103,19],[61,78,103,27],[61,114,103,63,"task"],[61,118,103,67],[61,119,103,68,"name"],[61,123,103,19],[61,124,103,10],[63,0,104,10],[63,19,104,15,"_genPromise"],[63,30,104,10],[63,31,104,27,"task"],[63,35,104,10],[64,0,105,9],[64,13,102,8],[64,19,105,15],[64,23,105,19],[64,30,105,26,"task"],[64,34,105,19],[64,39,105,35],[64,47,105,19],[64,51,105,47,"task"],[64,55,105,51],[64,56,105,52,"run"],[64,59,105,15],[64,61,105,57],[65,0,106,10,"DEBUG"],[65,14,106,10,"DEBUG"],[65,19,106,15],[65,23,106,19],[65,78,106,27],[65,103,106,52,"task"],[65,107,106,56],[65,108,106,57,"name"],[65,112,106,19],[65,113,106,10],[66,0,107,10,"task"],[66,14,107,10,"task"],[66,18,107,14],[66,19,107,15,"run"],[66,22,107,10],[67,0,108,9],[67,13,105,15],[67,19,108,15],[68,0,109,10],[68,58,110,12],[68,65,110,19,"task"],[68,69,110,12],[68,74,110,28],[68,84,109,10],[68,86,111,12],[68,148,112,14,"JSON"],[68,152,112,18],[68,153,112,19,"stringify"],[68,162,112,14],[68,163,112,29,"task"],[68,167,112,14],[68,169,112,35],[68,173,112,14],[68,175,112,41],[68,176,112,14],[68,177,109,10],[70,0,114,10,"DEBUG"],[70,14,114,10,"DEBUG"],[70,19,114,15],[70,23,114,19],[70,78,114,27],[70,109,114,19],[70,110,114,10],[71,0,115,10,"task"],[71,14,115,10,"task"],[71,18,115,14],[72,0,116,9],[73,0,117,7],[73,11,101,6],[73,12,117,8],[73,19,117,15,"e"],[73,20,117,8],[73,22,117,18],[74,0,118,8,"e"],[74,12,118,8,"e"],[74,13,118,9],[74,14,118,10,"message"],[74,21,118,8],[74,24,119,10],[74,57,119,43,"task"],[74,61,119,47],[74,62,119,48,"name"],[74,66,119,43],[74,70,119,56],[74,72,119,10],[74,76,119,62],[74,80,119,10],[74,83,119,69,"e"],[74,84,119,70],[74,85,119,71,"message"],[74,92,118,8],[75,0,120,8],[75,18,120,14,"e"],[75,19,120,8],[76,0,121,7],[77,0,122,5],[78,0,123,3],[81,13,132,2],[81,41,132,34],[82,0,133,4],[82,12,133,10,"stackIdx"],[82,20,133,18],[82,23,133,21],[82,28,133,26,"_queueStack"],[82,39,133,21],[82,40,133,38,"length"],[82,46,133,21],[82,49,133,47],[82,50,133,4],[83,0,134,4],[83,12,134,10,"queue"],[83,17,134,15],[83,20,134,18],[83,25,134,23,"_queueStack"],[83,36,134,18],[83,37,134,35,"stackIdx"],[83,45,134,18],[83,46,134,4],[85,0,135,4],[85,12,136,6,"queue"],[85,17,136,11],[85,18,136,12,"popable"],[85,25,136,6],[85,29,137,6,"queue"],[85,34,137,11],[85,35,137,12,"tasks"],[85,40,137,6],[85,41,137,18,"length"],[85,47,137,6],[85,52,137,29],[85,53,136,6],[85,57,138,6],[85,62,138,11,"_queueStack"],[85,73,138,6],[85,74,138,23,"length"],[85,80,138,6],[85,83,138,32],[85,84,135,4],[85,86,139,6],[86,0,140,6],[86,15,140,11,"_queueStack"],[86,26,140,6],[86,27,140,23,"pop"],[86,30,140,6],[88,0,141,6,"DEBUG"],[88,10,141,6,"DEBUG"],[88,15,141,11],[88,19,142,8],[88,74,142,16],[88,101,142,8],[88,103,142,45],[89,0,143,10,"stackIdx"],[89,12,143,10,"stackIdx"],[89,20,143,18],[89,22,143,10,"stackIdx"],[89,30,142,45],[90,0,144,10,"queueStackSize"],[90,12,144,10,"queueStackSize"],[90,26,144,24],[90,28,144,26],[90,33,144,31,"_queueStack"],[90,44,144,26],[90,45,144,43,"length"],[91,0,142,45],[91,11,142,8],[91,12,141,6],[92,0,146,6],[92,17,146,13],[92,22,146,18,"_getCurrentQueue"],[92,38,146,13],[92,40,146,6],[93,0,147,5],[93,9,135,4],[93,15,147,11],[94,0,148,6],[94,17,148,13,"queue"],[94,22,148,18],[94,23,148,19,"tasks"],[94,28,148,6],[95,0,149,5],[96,0,150,3],[99,13,152,2],[99,34,152,14,"task"],[99,38,152,2],[99,40,152,33],[100,0,152,33],[102,0,157,4],[102,13,157,9,"_queueStack"],[102,24,157,4],[102,25,157,21,"push"],[102,29,157,4],[102,30,157,26],[103,0,157,27,"tasks"],[103,10,157,27,"tasks"],[103,15,157,32],[103,17,157,34],[103,19,157,26],[104,0,157,38,"popable"],[104,10,157,38,"popable"],[104,17,157,45],[104,19,157,47],[105,0,157,26],[105,9,157,4],[107,0,158,4],[107,12,158,10,"stackIdx"],[107,20,158,18],[107,23,158,21],[107,28,158,26,"_queueStack"],[107,39,158,21],[107,40,158,38,"length"],[107,46,158,21],[107,49,158,47],[107,50,158,4],[108,0,159,4],[108,12,159,10,"stackItem"],[108,21,159,19],[108,24,159,22],[108,29,159,27,"_queueStack"],[108,40,159,22],[108,41,159,39,"stackIdx"],[108,49,159,22],[108,50,159,4],[109,0,160,4,"DEBUG"],[109,8,160,4,"DEBUG"],[109,13,160,9],[109,17,160,13],[109,72,160,21],[109,101,160,13],[109,103,160,52],[110,0,160,53,"stackIdx"],[110,10,160,53,"stackIdx"],[110,18,160,61],[110,20,160,53,"stackIdx"],[111,0,160,52],[111,9,160,13],[111,10,160,4],[112,0,161,4,"DEBUG"],[112,8,161,4,"DEBUG"],[112,13,161,9],[112,17,161,13],[112,72,161,21],[112,102,161,51,"task"],[112,106,161,55],[112,107,161,56,"name"],[112,111,161,13],[112,112,161,4],[113,0,162,4,"task"],[113,8,162,4,"task"],[113,12,162,8],[113,13,163,7,"gen"],[113,16,162,4],[113,19,164,7,"then"],[113,23,162,4],[113,24,164,12],[113,36,164,18],[114,0,165,8,"DEBUG"],[114,10,165,8,"DEBUG"],[114,15,165,13],[114,19,166,10],[114,74,166,18],[114,110,166,54,"task"],[114,114,166,58],[114,115,166,59,"name"],[114,119,166,10],[114,121,166,65],[115,0,167,12,"stackIdx"],[115,12,167,12,"stackIdx"],[115,20,167,20],[115,22,167,12,"stackIdx"],[115,30,166,65],[116,0,168,12,"queueStackSize"],[116,12,168,12,"queueStackSize"],[116,26,168,26],[116,28,168,28],[116,34,168,32],[116,35,168,33,"_queueStack"],[116,46,168,28],[116,47,168,45,"length"],[117,0,166,65],[117,11,166,10],[117,12,165,8],[118,0,170,8,"stackItem"],[118,10,170,8,"stackItem"],[118,19,170,17],[118,20,170,18,"popable"],[118,27,170,8],[118,30,170,28],[118,34,170,8],[119,0,171,8],[119,10,171,8],[119,16,171,12],[119,17,171,13,"hasTasksToProcess"],[119,34,171,8],[119,40,171,36],[119,46,171,40],[119,47,171,41,"_onMoreTasks"],[119,59,171,36],[119,61,171,8],[120,0,172,7],[120,9,162,4],[120,11,173,7,"catch"],[120,16,162,4],[120,17,173,13],[120,27,173,13,"ex"],[120,29,173,15],[120,31,173,19],[121,0,174,8,"ex"],[121,10,174,8,"ex"],[121,12,174,10],[121,13,174,11,"message"],[121,20,174,8],[121,71,174,67,"task"],[121,75,174,71],[121,76,174,72,"name"],[121,80,174,8],[121,90,174,81,"ex"],[121,92,174,83],[121,93,174,84,"message"],[121,100,174,8],[122,0,175,8],[122,16,175,14,"ex"],[122,18,175,8],[123,0,176,7],[123,9,162,4],[123,11,177,7,"done"],[123,15,162,4],[124,0,178,3],[130,0,181,0,"module"],[130,2,181,0,"module"],[130,8,181,6],[130,9,181,7,"exports"],[130,16,181,0],[130,19,181,17,"TaskQueue"],[130,28,181,0]],"functionMap":{"names":["<global>","TaskQueue","constructor","enqueue","enqueueTasks","tasks.forEach$argument_0","cancelTasks","_queueStack.map$argument_0","queue.tasks.filter$argument_0","_queueStack.map.filter$argument_0","hasTasksToProcess","processNext","_getCurrentQueue","_genPromise","task.gen.then$argument_0","task.gen.then._catch$argument_0"],"mappings":"AAA;AC2C;ECQ;GDG;EEO;GFE;EGE;kBCC,0BD;GHC;EKE;WCG;kCCE,0CD;QDC;cGC,mDH;GLC;ESY;GTE;EUK;GV0B;EWS;GXkB;EYE;YCY;ODQ;aEC;OFG;GZE;CDC"}},"type":"js/module"}]}